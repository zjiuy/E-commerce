{% extends 'base.html' %}

{% block  title%}
种类包装词云图
{% endblock %}

{% block sidebar%}
    <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">
      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'home' %}">
          <i class="bi bi-grid"></i>
          <span>首页</span>
        </a>
      </li>
      <li class="nav-heading">个人信息</li>
      <li class="nav-item">
        <a class="nav-link collapsed"  href="{% url 'changeSelfInfo' %}">
          <i class="bi bi-menu-button-wide"></i><span>修改信息</span></i>
        </a>
      </li><!-- End Components Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed"  href="{% url 'changePassword' %}">
          <i class="bi bi-journal-text"></i><span>修改密码</span>
        </a>
      </li>
      <li class="nav-heading">周热销榜单</li>

      <li class="nav-item">
        <a class="nav-link " href="{% url 'tableData' %}">
          <i class="bi bi-layout-text-window-reverse"></i><span>榜单分析</span>
        </a>
      </li>
      <li class="nav-heading">数据可视化分析</li>

      <li class="nav-item">
        <a class="nav-link collapsed"  href="{% url 'cityChar' %}">
          <i class="bi bi-bar-chart"></i><span>知识图谱可视化</span></i>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'rateChar' %}">
          <i class="bi bi-gem"></i><span>商品分类分析</span>
        </a>
      </li><!-- End Icons Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'priceChar' %}">
          <i class="bi bi-person"></i>
          <span>价格销量分析</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'commentsChar' %}">
          <i class="bi bi-question-circle"></i>
          <span>产地品牌分析</span>
        </a>
      </li>
      <li class="nav-heading">推荐功能</li>
        <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'recommendation' %}">
          <i class="bi bi-envelope"></i>
          <span>商品推荐</span>
        </a>
      </li><!-- End Contact Page Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'recommendation' %}">
          <i class="bi bi-envelope"></i>
          <span>AI问答</span>
        </a>
      </li><!-- End Contact Page Nav -->
      <li class="nav-heading">词云图</li>

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'detailIntroCloud' %}">
          <i class="bi bi-card-list"></i>
          <span>种类包装词云图</span>
        </a>

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'commentContentCloud' %}">
          <i class="bi bi-box-arrow-in-right"></i>
          <span>商品描述词云图</span>
        </a>
      </li>
    </ul>

  </aside>

{% endblock %}


{% block content %}
      <div class="pagetitle" style="display: flex;align-items: center">
      <div style="margin-right: auto">
          <h1>种类包装词云图</h1>
        <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'home' %}">数据可视化</a></li>
          <li class="breadcrumb-item active">种类包装词云图</li>
        </ol>
      </nav>
      </div>
        <h5 style="font-weight: normal">
            {{ nowTime.year }} - {{ nowTime.mon }} - {{ nowTime.day }}
        </h5>
    </div>


      <section class="section dashboard">
            <!-- 在面包屑导航下方添加筛选表单 -->
         <!-- 在面包屑导航下方添加筛选表单 -->
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">榜单筛选</h5>
                        <form action="{% url 'getcloud1Img' %}" method="GET">
                            <div class="row mb-3">
                                <label class="col-sm-2 col-form-label">选择榜单类型</label>
                                <div class="col-sm-10">
                                    <div class="input-group">
                                        <select class="form-select" name="category">
                                            <option value="">全部榜单</option>
                                            <option value="茗茶">茗茶</option>
                                            <option value="身体护理">身体护理</option>
                                            <option value="母婴纸品">母婴纸品</option>
                                            <option value="休闲零食">休闲零食</option>
                                            <option value="香水">香水</option>
                                            <option value="饮料冲调">饮料冲调</option>
                                            <option value="被芯">被芯</option>
                                            <option value="眼部护理">眼部护理</option>
                                            <option value="喂养洗护">喂养洗护</option>
                                            <option value="营养辅食">营养辅食</option>
                                            <option value="儿童早教机/儿童平板">儿童早教机/儿童平板</option>
                                            <option value="学习机">学习机</option>
                                            <option value="底妆">底妆</option>
                                            <option value="护肤套装">护肤套装</option>
                                            <option value="眼妆">眼妆</option>
                                            <option value="头发护理">头发护理</option>
                                            <option value="口红">口红</option>
                                            <option value="口腔护理">口腔护理</option>
                                            <option value="空气炸锅">空气炸锅</option>
                                            <option value="男式卫衣">男式卫衣</option>
                                        </select>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-funnel"></i> 生成
                                        </button>
                                        <a href="{% url 'getcloud1Img' %}" class="btn btn-secondary">
                                            <i class="bi bi-arrow-clockwise"></i> 重置
                                        </a>
                                    </div>
                                    <small class="form-text text-muted">选择要分析的榜单类型</small>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
              <div class="row">
                <div class="col-lg-12">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title" id="wordCloudTitle">
                          {% if category %}
                              {{ category }}商品词云图
                          {% else %}
                              商品词云图
                          {% endif %}
                      </h5>
                        <div id="mains" style="width:100%;height: 650px;text-align: center">
                             <img id="cloudImage" style="width:50%" src="/static/Cloud1.jpg?v={{ nowTime|stringformat:"s" }}" alt="">
                        </div>
                    </div>
                  </div>
                </div>
              </div>
      </section>


{% endblock %}

{% block echarts%}
    <script>
    // 在页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 获取表单和标题元素
            const filterForm = document.getElementById('filterForm');
            const categorySelect = document.getElementById('categorySelect');
            const wordCloudTitle = document.getElementById('wordCloudTitle');
            
            // 检查 URL 中是否有 category 参数
            const urlParams = new URLSearchParams(window.location.search);
            const categoryFromUrl = urlParams.get('category');
            
            if (categoryFromUrl) {
                // 如果 URL 中有 category 参数，更新标题
                wordCloudTitle.textContent = `${categoryFromUrl}商品词云图`;
                
                // 设置下拉菜单的选择项
                categorySelect.value = categoryFromUrl;
            }
            
            // 表单提交事件
            filterForm.addEventListener('submit', function(e) {
                // 获取选择的类别
                const selectedCategory = categorySelect.value;
                
                // 如果选择了类别，更新标题
                if (selectedCategory) {
                    wordCloudTitle.textContent = `${selectedCategory}商品词云图`;
                } else {
                    wordCloudTitle.textContent = '评论内容词云图';
                }
                // 更新图片的 src 属性，添加时间戳以避免缓存
                const timestamp = new Date().getTime();
                cloudImage.src = `/static/Cloud1.jpg?v=${timestamp}`;
            });
        });
    </script>
    <script>
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
        // 获取下拉菜单元素
        var categorySelect = document.querySelector('select[name="category"]');
        
        // 检查 URL 中是否有 category 参数
        var urlParams = new URLSearchParams(window.location.search);
        var selectedCategory = urlParams.get('category');
        
        // 如果 URL 中有 category 参数，设置下拉菜单的选中值
        if (selectedCategory) {
            categorySelect.value = selectedCategory;
        }
    });
</script>
{% endblock %}